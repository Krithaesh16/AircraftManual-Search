{% extends "layout.html" %}
{% block content %}
<section class="card">
  <h1>Search PDFs</h1>
  <form method="get" action="{{ url_for('index') }}" class="row">
    <input type="text" name="q" placeholder="Type a defect, e.g., 'hydraulic leak'" value="{{ request.args.get('q','') }}" required>
    <button type="submit">Search</button>
  </form>

  {% if results is defined %}
    <h2>Results{% if total is defined %} ({{ total }}){% endif %}</h2>
    {% if results %}
      <ul class="results">
      {% for r in results %}
        <li>
          <div class="title">
            <strong>{{ r['title'] }}</strong>
            <span class="meta">â€” page {{ r['page'] }}</span>
          </div>
          <div class="snippet">{{ r['snippet']|safe }}</div>
          <div class="actions">
            <a href="{{ url_for('serve_pdf', filename=r['filename']) }}#page={{ r['page'] }}" target="_blank">Open PDF at page</a>
          </div>
        </li>
      {% endfor %}
      </ul>
    {% else %}
      <p>No matches.</p>
    {% endif %}
  {% endif %}
</section>
{% endblock %}
